<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Charles的代理设置 | 老高的技术博客</title><meta name=keywords content="charles"><meta name=description content="MacOS下的开发少不了抓包调试，而Charles绝对是开发者必不可少的抓包工具！
不过老高在使用Charles时遇到了不少坑，下面总结一下再MacOS下Charles的使用方法吧。"><meta name=author content="Me"><link rel=canonical href=https://phpgao.github.io/setup_charles.html><link crossorigin=anonymous href=/assets/css/stylesheet.min.1a6ee89730e13a801d0f34e0cb5b98e96cf8c65b80500638bd599fc224ed8442.css integrity="sha256-Gm7olzDhOoAdDzTgy1uY6Wz4xluAUAY4vVmfwiTthEI=" rel="preload stylesheet" as=style><link rel=preload href="https://cdn.v2ex.com/gravatar/2b66f45a3e2f41db6522381006bfaea1?s=192" as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://phpgao.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://phpgao.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://phpgao.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://phpgao.github.io/apple-touch-icon.png><link rel=mask-icon href=https://phpgao.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-39288145-2','auto'),ga('send','pageview'))</script><meta property="og:title" content="Charles的代理设置"><meta property="og:description" content="MacOS下的开发少不了抓包调试，而Charles绝对是开发者必不可少的抓包工具！
不过老高在使用Charles时遇到了不少坑，下面总结一下再MacOS下Charles的使用方法吧。"><meta property="og:type" content="article"><meta property="og:url" content="https://phpgao.github.io/setup_charles.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-07-08T02:12:00+00:00"><meta property="article:modified_time" content="2019-07-08T02:12:00+00:00"><meta property="og:site_name" content="老高的技术博客"><meta name=twitter:card content="summary"><meta name=twitter:title content="Charles的代理设置"><meta name=twitter:description content="MacOS下的开发少不了抓包调试，而Charles绝对是开发者必不可少的抓包工具！
不过老高在使用Charles时遇到了不少坑，下面总结一下再MacOS下Charles的使用方法吧。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://phpgao.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Charles的代理设置","item":"https://phpgao.github.io/setup_charles.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Charles的代理设置","name":"Charles的代理设置","description":"MacOS下的开发少不了抓包调试，而Charles绝对是开发者必不可少的抓包工具！\n不过老高在使用Charles时遇到了不少坑，下面总结一下再MacOS下Charles的使用方法吧。\n","keywords":["charles"],"articleBody":"MacOS下的开发少不了抓包调试，而Charles绝对是开发者必不可少的抓包工具！\n不过老高在使用Charles时遇到了不少坑，下面总结一下再MacOS下Charles的使用方法吧。\n信任证书 为什么要信任证书？这不废话么，Charles利用了中间人攻击，所以需要先让你的机器信任他的证书才可以进行正常劫持。\n这一点Charles已经做到很傻瓜了。\n# 为你的MacOS安装证书 Help -- SSL Proxying -- Install Charles Root Certificate 如果要给手机安装证书，那么可以参考下面一段话：\nConfigure your device to use Charles as its HTTP proxy on 192.168.2.198:8888, then browse to chls.pro/ssl to download and install the certificate. Note that on iOS 10 and later you must then go into Settings  General  About  Certificate Trust Settings and enable the Charles certificate to be trusted. 大意：\n 确保你的设备的代理设置为 192.168.2.198:8888，不同的机器IP代理IP和端口不同! 用手机访问 chls.pro/ssl，然后下载并安装证书即可！ 额外的，IOS10+的手机，需要到，设置通用关于证书信任，信任Charles的证书  done!\n自动代理 在设置Charles代理的时候，Charles有一个选项，在 Proxy -- macOS Proxy。如果这个选项打勾，Charles会帮你自动设置MacOS的http和https代理为Charles提供的代理。\n这个功能虽然很方便，但是也会影响一些APP的使用。比如老高在开启Charles后，使用pip3 install scrapy命令的时候，就会被抛出下面的错误，很明显，pip在程序中检查了证书，所以导致无法安装新包。\nWARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLError(\"bad handshake: Error([('SSL routines', 'tls_process_server_certificate', 'certificate verify failed')])\"))': /pypi 解决的办法也很简单，取消打勾就行。\n在日常的开发中，老高还是偏向明确指定代理地址，而不是在程序执行的环境中设置，除非你明确的知道这样做的影响和带来的后果。\n高级操作 仅代理部分url Proxy – SSL Proxying Settings\n不要使用*:443，而是针对需要调试的域名，比如*.googe.com:443 www.phpgao.com:443\nthrottle 这个词可以理解为，油门，阀门，用来控制流量的，即访问网络的速度。在设置界面我们可以改的很多，这一点不展开讲了\nMap功能 有两个：\nMap Remote 和Map Local，其功能是把指定的请求映射到另一个远程或者本地的地址。是不是有点像反向代理？\nRewrite 这个功能支持修改req和resp中的信息，因为http对于我们已经是明文了，所以想改什么都可以。\n更多 待续\n","wordCount":"127","inLanguage":"en","datePublished":"2019-07-08T02:12:00Z","dateModified":"2019-07-08T02:12:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://phpgao.github.io/setup_charles.html"},"publisher":{"@type":"Organization","name":"老高的技术博客","logo":{"@type":"ImageObject","url":"https://phpgao.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://phpgao.github.io/ accesskey=h title="老高的博客 (Alt + H)">老高的博客</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://phpgao.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://phpgao.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://blog.phpgao.com title="old blog"><span>old blog</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://phpgao.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://phpgao.github.io/posts/>Posts</a></div><h1 class=post-title>Charles的代理设置</h1><div class=post-meta>July 8, 2019&nbsp;·&nbsp;1 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/2019-07-08_setup_charles.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>MacOS下的开发少不了抓包调试，而Charles绝对是开发者必不可少的抓包工具！</p><p>不过老高在使用Charles时遇到了不少坑，下面总结一下再MacOS下Charles的使用方法吧。</p><h2 id=信任证书>信任证书<a hidden class=anchor aria-hidden=true href=#信任证书>#</a></h2><p>为什么要信任证书？这不废话么，Charles利用了中间人攻击，所以需要先让你的机器信任他的证书才可以进行正常劫持。</p><p>这一点Charles已经做到很傻瓜了。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># 为你的MacOS安装证书
Help --&gt; SSL Proxying --&gt; Install Charles Root Certificate
</code></pre></div><p>如果要给手机安装证书，那么可以参考下面一段话：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Configure your device to use Charles as its HTTP proxy on 192.168.2.198:8888, then browse to chls.pro/ssl to download and install the certificate.

Note that on iOS 10 and later you must then go into Settings &gt; General &gt; About &gt; Certificate Trust Settings and enable the Charles certificate to be trusted.
</code></pre></div><p>大意：</p><ol><li>确保你的设备的代理设置为 <code>192.168.2.198:8888</code>，<strong>不同的机器IP代理IP和端口不同!</strong></li><li>用手机访问 <code>chls.pro/ssl</code>，然后下载并安装证书即可！</li><li>额外的，IOS10+的手机，需要到，设置>通用>关于>证书信任，信任Charles的证书</li></ol><p>done!</p><h2 id=自动代理>自动代理<a hidden class=anchor aria-hidden=true href=#自动代理>#</a></h2><p>在设置Charles代理的时候，Charles有一个选项，在 <code>Proxy --> macOS Proxy</code>。如果这个选项打勾，Charles会帮你自动设置MacOS的http和https代理为Charles提供的代理。</p><p>这个功能虽然很方便，但是也会影响一些APP的使用。比如老高在开启Charles后，使用<code>pip3 install scrapy</code>命令的时候，就会被抛出下面的错误，很明显，pip在程序中检查了证书，所以导致无法安装新包。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by &#39;SSLError(SSLError(&#34;bad handshake: Error([(&#39;SSL routines&#39;, &#39;tls_process_server_certificate&#39;, &#39;certificate verify failed&#39;)])&#34;))&#39;: /pypi
</code></pre></div><p>解决的办法也很简单，取消打勾就行。</p><p>在日常的开发中，老高还是偏向明确指定代理地址，而不是在程序执行的环境中设置，除非你明确的知道这样做的影响和带来的后果。</p><h2 id=高级操作>高级操作<a hidden class=anchor aria-hidden=true href=#高级操作>#</a></h2><h3 id=仅代理部分url>仅代理部分url<a hidden class=anchor aria-hidden=true href=#仅代理部分url>#</a></h3><p>Proxy &ndash;> SSL Proxying Settings</p><p>不要使用<code>*:443</code>，而是针对需要调试的域名，比如<code>*.googe.com:443</code> <code>www.phpgao.com:443</code></p><h3 id=throttle>throttle<a hidden class=anchor aria-hidden=true href=#throttle>#</a></h3><p>这个词可以理解为，油门，阀门，用来控制流量的，即访问网络的速度。在设置界面我们可以改的很多，这一点不展开讲了</p><h3 id=map功能>Map功能<a hidden class=anchor aria-hidden=true href=#map功能>#</a></h3><p>有两个：</p><p>Map Remote 和Map Local，其功能是把指定的请求映射到另一个远程或者本地的地址。是不是有点像反向代理？</p><h3 id=rewrite>Rewrite<a hidden class=anchor aria-hidden=true href=#rewrite>#</a></h3><p>这个功能支持修改req和resp中的信息，因为http对于我们已经是明文了，所以想改什么都可以。</p><h3 id=更多>更多<a hidden class=anchor aria-hidden=true href=#更多>#</a></h3><p>待续</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://phpgao.github.io/tags/charles/>charles</a></li></ul><nav class=paginav><a class=prev href=https://phpgao.github.io/wow_server.html><span class=title>« Prev Page</span><br><span>从零开始编译wow私服</span></a>
<a class=next href=https://phpgao.github.io/scrapy_hearthstone.html><span class=title>Next Page »</span><br><span>炉石传说有多少张卡牌</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://phpgao.github.io/>老高的技术博客</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>