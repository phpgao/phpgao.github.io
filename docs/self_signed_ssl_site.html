<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>在Linux下建立自签名的https网站 | 老高的技术博客</title><meta name=keywords content="ssl"><meta name=description content="学习完了证书，密钥，加密，rsa到底是啥？一文后，我们就可以开始着手建立一个自签名的网站了！"><meta name=author content="Me"><link rel=canonical href=https://phpgao.github.io/self_signed_ssl_site.html><link crossorigin=anonymous href=/assets/css/stylesheet.min.1a6ee89730e13a801d0f34e0cb5b98e96cf8c65b80500638bd599fc224ed8442.css integrity="sha256-Gm7olzDhOoAdDzTgy1uY6Wz4xluAUAY4vVmfwiTthEI=" rel="preload stylesheet" as=style><link rel=preload href="https://cdn.v2ex.com/gravatar/2b66f45a3e2f41db6522381006bfaea1?s=192" as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://phpgao.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://phpgao.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://phpgao.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://phpgao.github.io/apple-touch-icon.png><link rel=mask-icon href=https://phpgao.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-39288145-2','auto'),ga('send','pageview'))</script><meta property="og:title" content="在Linux下建立自签名的https网站"><meta property="og:description" content="学习完了证书，密钥，加密，rsa到底是啥？一文后，我们就可以开始着手建立一个自签名的网站了！"><meta property="og:type" content="article"><meta property="og:url" content="https://phpgao.github.io/self_signed_ssl_site.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-06-09T13:32:00+00:00"><meta property="article:modified_time" content="2016-06-09T13:32:00+00:00"><meta property="og:site_name" content="老高的技术博客"><meta name=twitter:card content="summary"><meta name=twitter:title content="在Linux下建立自签名的https网站"><meta name=twitter:description content="学习完了证书，密钥，加密，rsa到底是啥？一文后，我们就可以开始着手建立一个自签名的网站了！"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://phpgao.github.io/posts/"},{"@type":"ListItem","position":2,"name":"在Linux下建立自签名的https网站","item":"https://phpgao.github.io/self_signed_ssl_site.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"在Linux下建立自签名的https网站","name":"在Linux下建立自签名的https网站","description":"学习完了证书，密钥，加密，rsa到底是啥？一文后，我们就可以开始着手建立一个自签名的网站了！\n","keywords":["ssl"],"articleBody":"学习完了证书，密钥，加密，rsa到底是啥？一文后，我们就可以开始着手建立一个自签名的网站了！\n安装nginx 安装编译nginx\n生成证书 # 建立ssl文件夹 mkdir /etc/nginx/ssl # -subj 后面是一些创建CRT所需要的基础信息，CN一定要填写域名 openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout /etc/nginx/ssl/laogao.key -out /etc/nginx/ssl/laogao.crt -subj \\ \"/C=CN/ST=Shanghai/L=Shanghai/O=Qihoo 360/OU=IT Dept/CN=blog.phpgao.com/emailAddress=admin@phpgao.com\" 配置nginx server { listen 80 default_server; listen [::]:80 default_server ipv6only=on; listen 443 ssl; root /usr/share/nginx/html; index index.php index.html index.htm; server_name your_domain.com; ssl_certificate /etc/nginx/ssl/laogao.crt; ssl_certificate_key /etc/nginx/ssl/laogao.key; location / { try_files $uri $uri/ =404; } } 测试 curl命令 # 正常请求https会报错，说证书有问题 curl https://blog.phpgao.com curl: (60) SSL certificate problem: Invalid certificate chain More details here: http://curl.haxx.se/docs/sslcerts.html curl performs SSL certificate verification by default, using a \"bundle\" of Certificate Authority (CA) public keys (CA certs). If the default bundle file isn't adequate, you can specify an alternate file using the --cacert option. If this HTTPS server uses a certificate signed by a CA represented in the bundle, the certificate verification probably failed due to a problem with the certificate (it might be expired, or the name might not match the domain name in the URL). If you'd like to turn off curl's verification of the certificate, use the -k (or --insecure) option. # 加上-k选项即可正常访问 curl -vk https://blog.phpgao.com 浏览器 使用浏览器访问网站，会报错！\n点击继续即可访问。\n添加至系统根证书列表 # centos7 sudo cat /etc/nginx/ssl/nginx.crt  /etc/pki/tls/certs/ca-bundle.crt ","wordCount":"191","inLanguage":"en","datePublished":"2016-06-09T13:32:00Z","dateModified":"2016-06-09T13:32:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://phpgao.github.io/self_signed_ssl_site.html"},"publisher":{"@type":"Organization","name":"老高的技术博客","logo":{"@type":"ImageObject","url":"https://phpgao.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://phpgao.github.io/ accesskey=h title="老高的博客 (Alt + H)">老高的博客</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://phpgao.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://phpgao.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://blog.phpgao.com title="old blog"><span>old blog</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://phpgao.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://phpgao.github.io/posts/>Posts</a></div><h1 class=post-title>在Linux下建立自签名的https网站</h1><div class=post-meta>June 9, 2016&nbsp;·&nbsp;1 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/2016-06-09_self_signed_ssl_site.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>学习完了<a href=https://blog.phpgao.com/encryption_decryption.html>证书，密钥，加密，rsa到底是啥？</a>一文后，我们就可以开始着手建立一个自签名的网站了！</p><h2 id=安装nginx>安装nginx<a hidden class=anchor aria-hidden=true href=#安装nginx>#</a></h2><p><a href=https://blog.phpgao.com/nginx_installation.html>安装编译nginx</a></p><h2 id=生成证书>生成证书<a hidden class=anchor aria-hidden=true href=#生成证书>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># 建立ssl文件夹
mkdir /etc/nginx/ssl
# -subj 后面是一些创建CRT所需要的基础信息，CN一定要填写域名
openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout /etc/nginx/ssl/laogao.key -out /etc/nginx/ssl/laogao.crt -subj \
&#34;/C=CN/ST=Shanghai/L=Shanghai/O=Qihoo 360/OU=IT Dept/CN=blog.phpgao.com/emailAddress=admin@phpgao.com&#34;
</code></pre></div><h2 id=配置nginx>配置nginx<a hidden class=anchor aria-hidden=true href=#配置nginx>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>server {
        listen 80 default_server;
        listen [::]:80 default_server ipv6only=on;

        listen 443 ssl;

        root /usr/share/nginx/html;
        index index.php index.html index.htm;

        server_name your_domain.com;
        ssl_certificate /etc/nginx/ssl/laogao.crt;
        ssl_certificate_key /etc/nginx/ssl/laogao.key;

        location / {
                try_files $uri $uri/ =404;
        }
}
</code></pre></div><h2 id=测试>测试<a hidden class=anchor aria-hidden=true href=#测试>#</a></h2><h3 id=curl命令>curl命令<a hidden class=anchor aria-hidden=true href=#curl命令>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># 正常请求https会报错，说证书有问题
curl https://blog.phpgao.com

curl: (60) SSL certificate problem: Invalid certificate chain
More details here: http://curl.haxx.se/docs/sslcerts.html

curl performs SSL certificate verification by default, using a &#34;bundle&#34;
 of Certificate Authority (CA) public keys (CA certs). If the default
 bundle file isn&#39;t adequate, you can specify an alternate file
 using the --cacert option.
If this HTTPS server uses a certificate signed by a CA represented in
 the bundle, the certificate verification probably failed due to a
 problem with the certificate (it might be expired, or the name might
 not match the domain name in the URL).
If you&#39;d like to turn off curl&#39;s verification of the certificate, use
 the -k (or --insecure) option.

# 加上-k选项即可正常访问
curl -vk https://blog.phpgao.com
</code></pre></div><h3 id=浏览器>浏览器<a hidden class=anchor aria-hidden=true href=#浏览器>#</a></h3><p>使用浏览器访问网站，会报错！</p><p><img loading=lazy src=https://blog.phpgao.com/usr/uploads/2016/06/2978094777.jpg alt=ssl></p><p>点击继续即可访问。</p><h2 id=添加至系统根证书列表>添加至系统根证书列表<a hidden class=anchor aria-hidden=true href=#添加至系统根证书列表>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># centos7
sudo cat /etc/nginx/ssl/nginx.crt &gt;&gt; /etc/pki/tls/certs/ca-bundle.crt

</code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://phpgao.github.io/tags/ssl/>ssl</a></li></ul><nav class=paginav><a class=prev href=https://phpgao.github.io/ngrok_how_to.html><span class=title>« Prev Page</span><br><span>自己建立ngrok服务器进行内网穿透</span></a>
<a class=next href=https://phpgao.github.io/encryption_decryption.html><span class=title>Next Page »</span><br><span>证书，密钥，加密，rsa到底是啥？</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://phpgao.github.io/>老高的技术博客</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>