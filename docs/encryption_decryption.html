<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>证书，密钥，加密，rsa到底是啥？ | 老高的技术博客</title><meta name=keywords content="rsa,ca"><meta name=description content="简单的回答：
证书也叫CA(Certification Authority)证书；密钥就是用来加解密用的文件或者字符串；rsa即非对称加密算法。

"><meta name=author content="Me"><link rel=canonical href=https://phpgao.github.io/encryption_decryption.html><link crossorigin=anonymous href=/assets/css/stylesheet.min.1a6ee89730e13a801d0f34e0cb5b98e96cf8c65b80500638bd599fc224ed8442.css integrity="sha256-Gm7olzDhOoAdDzTgy1uY6Wz4xluAUAY4vVmfwiTthEI=" rel="preload stylesheet" as=style><link rel=preload href="https://cdn.v2ex.com/gravatar/2b66f45a3e2f41db6522381006bfaea1?s=192" as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://phpgao.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://phpgao.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://phpgao.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://phpgao.github.io/apple-touch-icon.png><link rel=mask-icon href=https://phpgao.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-39288145-2','auto'),ga('send','pageview'))</script><meta property="og:title" content="证书，密钥，加密，rsa到底是啥？"><meta property="og:description" content="简单的回答：
证书也叫CA(Certification Authority)证书；密钥就是用来加解密用的文件或者字符串；rsa即非对称加密算法。

"><meta property="og:type" content="article"><meta property="og:url" content="https://phpgao.github.io/encryption_decryption.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-06-03T06:27:00+00:00"><meta property="article:modified_time" content="2016-06-03T06:27:00+00:00"><meta property="og:site_name" content="老高的技术博客"><meta name=twitter:card content="summary"><meta name=twitter:title content="证书，密钥，加密，rsa到底是啥？"><meta name=twitter:description content="简单的回答：
证书也叫CA(Certification Authority)证书；密钥就是用来加解密用的文件或者字符串；rsa即非对称加密算法。

"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://phpgao.github.io/posts/"},{"@type":"ListItem","position":2,"name":"证书，密钥，加密，rsa到底是啥？","item":"https://phpgao.github.io/encryption_decryption.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"证书，密钥，加密，rsa到底是啥？","name":"证书，密钥，加密，rsa到底是啥？","description":"简单的回答：\n证书也叫CA(Certification Authority)证书；密钥就是用来加解密用的文件或者字符串；rsa即非对称加密算法。\n","keywords":["rsa","ca"],"articleBody":"简单的回答：\n证书也叫CA(Certification Authority)证书；密钥就是用来加解密用的文件或者字符串；rsa即非对称加密算法。\n密钥 密钥在非对称加密的领域里，指的是私钥和公钥，他们总是成对出现，其主要作用是加密和解密，具体原理可以参考RSA加密算法。\n需要指出的是，WIKI中提到1999年，RSA-155 (512 bits)被成功分解，2009年12月12日，编号为RSA-768（768 bits, 232 digits）数也被成功分解，目前老高建议直接使用2048-bit或4086-bit的加密强度。\nopenssl  openssl EN文档 openssl 中文文档  在说私钥公钥之前，大家可能需要先熟悉熟悉openssl命令行工具，openssl是一个强大的加密、解密工具，由开源组织维护。利用openssl工具，我们可以实现一些常见的摘要算法，如Linux下简单计算md5,base64,sha1,sha2\n# 帮助信息 Standard(标准) commands asn1parse ca ciphers crl crl2pkcs7 dgst dh dhparam dsa dsaparam ec ecparam enc engine errstr gendh gendsa genrsa nseq ocsp passwd pkcs12 pkcs7 pkcs8 prime rand req rsa rsautl s_client s_server s_time sess_id smime speed spkac verify version x509 Message Digest(信息摘要) commands (see the `dgst' command for more details) md2 md4 md5 mdc2 rmd160 sha sha1 Cipher(加密) commands (see the `enc' command for more details) aes-128-cbc aes-128-ecb aes-192-cbc aes-192-ecb aes-256-cbc aes-256-ecb base64 bf bf-cbc bf-cfb bf-ecb bf-ofb cast cast-cbc cast5-cbc cast5-cfb cast5-ecb cast5-ofb des des-cbc des-cfb des-ecb des-ede des-ede-cbc des-ede-cfb des-ede-ofb des-ede3 des-ede3-cbc des-ede3-cfb des-ede3-ofb des-ofb des3 desx rc2 rc2-40-cbc rc2-64-cbc rc2-cbc rc2-cfb rc2-ecb rc2-ofb rc4 rc4-40 seed seed-cbc seed-cfb seed-ecb seed-ofb # 加密的相关命令 options are -in  input file -out  output file -pass  pass phrase source -e encrypt -d decrypt -a/-base64 base64 encode/decode, depending on encryption flag -k passphrase is the next argument -kfile passphrase is the first line of the file argument -md the next argument is the md to use to create a key from a passphrase. One of md2, md5, sha or sha1 -K/-iv key/iv in hex is the next argument -[pP] print the iv/key (then exit if -P) -bufsize  buffer size -engine e use engine e, possibly a hardware device. 处理数据 信息摘要 # base64 echo -n \"phpgao\" | openssl base64 # 解密 -d == decrypt echo \"cGhwZ2Fv\" | openssl base64 -d # 对一个文件计算摘要，下同 openssl base64 -in nginx.conf # md5 echo -n \"phpgao\" | openssl md5 # sha128 echo -n \"phpgao\" | openssl sha1 加密解密 # 使用rc4算法加密php字符串，使用密钥phpgao，输出使用base64编码 echo -n \"php\" | openssl rc4 -k phpgao -base64 # 使用rc4算法解密字符串，使用密钥phpgao，输入使用base64编码 echo U2FsdGVkX18f3qEoEhVf+hsNOg== | openssl rc4 -d -k phpgao -base64 密钥相关操作 # 生成私钥 # genrsa 指使用rsa算法生成密钥文件 # -des3 指的是给私钥加密的算法(可选) openssl genrsa -des3 -out key_rsa 4096 openssl genrsa -out key_rsa 4096 # 移除已经存在的密码(先做一下备份) cp key_rsa old.key openssl rsa -in old.key -out key_rsa # 根据刚才创建的私钥创建公钥 openssl rsa -in key_rsa -pubout -out key_rsa.pub # 使用公钥加密数据 # -in 输入文件 echo -n \"phpgao\" | openssl rsautl -encrypt -pubin -inkey key_rsa.pub -out a.txt # 使用私钥解密数据 openssl rsautl -decrypt -inkey key_rsa -in a.txt # 查看密钥信息 openssl rsa -in key_rsa -text -noout openssl rsa -pubin -in key_rsa.pub -text -noout # 检查私钥 openssl rsa -check -in key_rsa # 检查一个CSR文件(后面有讲) openssl req -text -noout -verify -in domain.csr # 检查证书信息 openssl x509 -text -noout -in domain.crt 一些补充 关于密钥的格式 密钥的格式有很多种，我们在使用的时候需要注意。我们刚才使用openssl生成的密钥格式叫PKCS#1，不同的程序可能需要不同格式的密钥，不同格式的密钥是可以转换的。\nRSA Private Key (PKCS#1):\n-----BEGIN RSA PRIVATE KEY----- BASE64 ENCODED DATA -----END RSA PRIVATE KEY----- PKCS#1 RSA Public Key:\n-----BEGIN RSA PUBLIC KEY----- BASE64 ENCODED DATA -----END RSA PUBLIC KEY----- X.509 Public Key:\n-----BEGIN PUBLIC KEY----- BASE64 ENCODED DATA -----END PUBLIC KEY----- PKCS#8 Private Key:\n-----BEGIN PRIVATE KEY----- BASE64 ENCODED DATA -----END PRIVATE KEY----- PKCS#8 Encrypted Private Key:\n-----BEGIN ENCRYPTED PRIVATE KEY----- BASE64 ENCODED DATA -----END ENCRYPTED PRIVATE KEY----- SSH public key:\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6Fo/HHPELU4TLdQwZtidB4hph8xTQberQ8467l2wkXFKV1dlBncCLUA6SUD9JypHIb3I6VNv3rnoEWtRsQYFX5TwGqnxxxH7ZjMt2O1NE9OTEf7H50QmkhHBEKruuEt+OrRXSL6gwHwuAYvGl2nWyKhdaKPg2AMHV6NV3hKEiyEhCe9XCg72KTdHTOVpDS2RjnsU4spyioi9OVj5Eu3vjBeQUifULJzbgMqB0kYS+mJSiol+ZK2YOp1HdiR7vxqfi7r+d8LDhGox8mO00nlYc4h7LBOe75G5KktSbTt5Pyiim+DF6efvmtj2zJ/nN3H2ZHG1dLVQl82QJ8Kz3Rosh laogao@local 参考Converting OpenSSH public keys，我们可以使用命令 ssh-keygen -f id_rsa.pub -e -m pem 将ssh-rsa格式转为PKCS#1 PEM格式。\n更多格式（我们经常用到的没几个）：\n#define PEM_STRING_X509_OLD \"X509 CERTIFICATE\" #define PEM_STRING_X509 \"CERTIFICATE\" #define PEM_STRING_X509_PAIR \"CERTIFICATE PAIR\" #define PEM_STRING_X509_TRUSTED \"TRUSTED CERTIFICATE\" #define PEM_STRING_X509_REQ_OLD \"NEW CERTIFICATE REQUEST\" #define PEM_STRING_X509_REQ \"CERTIFICATE REQUEST\" #define PEM_STRING_X509_CRL \"X509 CRL\" #define PEM_STRING_EVP_PKEY \"ANY PRIVATE KEY\" #define PEM_STRING_PUBLIC \"PUBLIC KEY\" #define PEM_STRING_RSA \"RSA PRIVATE KEY\" #define PEM_STRING_RSA_PUBLIC \"RSA PUBLIC KEY\" #define PEM_STRING_DSA \"DSA PRIVATE KEY\" #define PEM_STRING_DSA_PUBLIC \"DSA PUBLIC KEY\" #define PEM_STRING_PKCS7 \"PKCS7\" #define PEM_STRING_PKCS7_SIGNED \"PKCS #7 SIGNED DATA\" #define PEM_STRING_PKCS8 \"ENCRYPTED PRIVATE KEY\" #define PEM_STRING_PKCS8INF \"PRIVATE KEY\" #define PEM_STRING_DHPARAMS \"DH PARAMETERS\" #define PEM_STRING_DHXPARAMS \"X9.42 DH PARAMETERS\" #define PEM_STRING_SSL_SESSION \"SSL SESSION PARAMETERS\" #define PEM_STRING_DSAPARAMS \"DSA PARAMETERS\" #define PEM_STRING_ECDSA_PUBLIC \"ECDSA PUBLIC KEY\" #define PEM_STRING_ECPARAMETERS \"EC PARAMETERS\" #define PEM_STRING_ECPRIVATEKEY \"EC PRIVATE KEY\" #define PEM_STRING_PARAMETERS \"PARAMETERS\" #define PEM_STRING_CMS \"CMS\" 列表来自what is the differences between “BEGIN RSA PRIVATE KEY” and “BEGIN PRIVATE KEY”\nCA证书 证书与密钥不同，CA证书指的是权威机构给我们颁发的证书，我们的电脑或者电子设备中内置了根证书，我们的电脑信任根证书。\n+-----------------+ +--------------------+ | | | | | | | | | | | | | browser/PC | ① GET / HTTP/1.0 | | | |-------------------- sites over https | | ① WAIT! Where is CA ?| | | +-------------------- | | | ④ Anyway,give me | | +-----+----^------+ the code! +--------------------+ | | | | | |③ He is good! ② Is's it| | a bad site? | | | +----------------------+ | | | | | +----+ | | | | | | CA | +--------- | | | | | +----------------------+ 证书原理 CA证书能够帮助我们鉴别某一个网站的合法性，简单的概括一下原理：\n 生成我的公钥 CA机构用自己的私钥加密我的公钥以及相关信息 客户信任CA，并拥有CA的公钥，客户就可以使用公钥解密加密后的证书，并从证书中得到我的公钥 如果能用CA的公钥解密出数据，说明我的证书是经过CA认证过的，客户就可以放心访问了，如果系统发现证书不是权威CA机构颁发的，会警告用户 客户使用我的公钥解密数据，然后进行信息交换  有一些需要注意的地方：\n 证书有有效期这一说 证书中的相关信息，需要包括改证书到根证书的信任链，如下图，bing.com的证书中，就能够顺藤摸瓜，找到根CA机构，所以在生成自己的证书后，一定要加入这个信任链才能让系统正确的识别到与证书相关的最终根CA。  ↑ bing的证书信息\n↑ blog.phpgao.com的证书信息\n证书格式 SSL使用X.509证书标准，编码格式有两种。\n证书的编码格式 PEM(Privacy Enhanced Mail)，通常用于数字证书认证机构（Certificate Authorities，CA），扩展名为.pem, .crt, .cer, and .key。内容为Base64编码的ASCII码文件，有类似\"—–BEGIN CERTIFICATE—–\" 和 “—–END CERTIFICATE—–“的头尾标记。服务器认证证书，中级认证证书和私钥都可以储存为PEM格式（认证证书其实就是公钥）。Apache和nginx等类似的服务器使用PEM格式证书。\nDER(Distinguished Encoding Rules)，与PEM不同之处在于其使用二进制而不是Base64编码的ASCII。扩展名为.der，但也经常使用.cer用作扩展名，所有类型的认证证书和私钥都可以存储为DER格式。Java使其典型使用平台。\n证书编码的转换 # PEM转为DER openssl x509 -in cert.crt -outform der -out cert.der # DER转为PEM openssl x509 -in cert.crt -inform der -outform pem -out cert.pem CSR  In public key infrastructure (PKI) systems, a certificate signing request (also CSR or certification request) is a message sent from an applicant to a certificate authority in order to apply for a digital identity certificate. The most common format for CSRs is the PKCS #10 specification and another is the Signed Public Key and Challenge Spkac format generated by some Web browsers. - Wiki of Certificate signing request\n CSR(Certificate Signing Request)，它是向CA机构申请数字身份证书时使用的请求文件，他最常见的格式是PKCS #10。在生成请求文件前，我们需要准备一对对称密钥。私钥信息自己保存，请求中会附上公钥信息以及国家，城市，域名，Email等信息，csr中还会附上签名信息。当我们准备好CSR文件后就可以提交给CA机构，等待他们给我们签名，签好名后我们会收到crt文件，即证书。\n# 帮助 openssl req -h # 生成CSR请求文件和私钥 openssl req -nodes -days 365 -newkey rsa:2048 -keyout key_rsa -out domain.csr # 从已存在的私钥生生成CSR请求文件 openssl req -new -days 365 -key key_rsa -out domain.csr # 信息可以直接写好 openssl req -new -days 3650 -key key_rsa -out domain.csr -subj \\ \"/C=CN/ST=Shanghai/L=Shanghai/O=Qihoo 360/OU=IT Dept/CN=blog.phpgao.com/emailAddress=admin@phpgao.com\" # 检查CSR文件信息 openssl req -text -noout -verify -in domain.csr CRT 其实我们最终就需要一个私钥文件和证书文件，这一步骤我们会得到CRT文件。\n自签名 当我们生成好CSR文件后，就可以开始签名了，是的，自己给自己签名！\nopenssl ca -h # 先生成一个CA根证书 openssl req -x509 -nodes -days 36500 -newkey rsa:2048 -keyout key_ca_rsa -out ca.crt # 使用CA的私钥签名 openssl ca -policy policy_anything -days 365 -cert ca.crt -keyfile key_rsa -in domain.csr -out domain.crt # 可能会出错，因为缺少一些必要文件 mkdir -p demoCA/newCerts touch demoCA/index.txt echo -n \"01\"  demoCA/serial 直接生成证书 我们当然也可以直接生成CRT文件。\n# 生成证书和私钥 openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout key_rsa -out key.crt # 从已存在的私钥生成生成证书 openssl req -x509 -new -days 365 -key domain.key -out domain.crt # 检查证书信息 openssl x509 -text -noout -in domain.crt 补充信息 CSR所需要的信息 CN = Country Name (2 letter code) ST = State or Province Name (full name) L = Locality Name (eg, city) O = Organization Name (eg, company) OU = Organizational Unit Name CN = Common Name (eg, your name or your server's hostname) # 例子 Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Shanghai Locality Name (eg, city) []:Shanghai Organization Name (eg, company) [Internet Widgits Pty Ltd]:Qihoo 360 Organizational Unit Name (eg, section) []:IT Dept Common Name (e.g. server FQDN or YOUR name) []:blog.phpgao.com Email Address []:admin@phpgao.com # 我们可以在需要输入以上信息的时候直接用下面的选项，就不用在一个一个输入了 -subj \\ \"/C=CN/ST=Shanghai/L=Shanghai/O=Qihoo 360/OU=IT Dept/CN=blog.phpgao.com/emailAddress=admin@phpgao.com\" Diffie-Hellman Diffie-Hellman加密算法的最终目的是为了完成通信双方对称秘钥的交互，但是它牛逼在即使处在不安全的环境（有人侦听）也不会造成秘钥泄露，生成的时间会比较长，请耐心等待。\nopenssl dhparam -out /etc/ssl/certs/dhparam.pem 2048 使用方法：\nssl_dhparam /etc/ssl/certs/dhparam.pem; SSL的nginx配置 # from https://cipherli.st/ # and https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; ssl_ciphers \"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH\"; ssl_ecdh_curve secp384r1; ssl_session_cache shared:SSL:10m; ssl_session_tickets off; ssl_stapling on; ssl_stapling_verify on; resolver 8.8.8.8 8.8.4.4 valid=300s; resolver_timeout 5s; add_header Strict-Transport-Security \"max-age=63072000; includeSubdomains; preload\"; add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; ssl_dhparam /etc/ssl/certs/dhparam.pem; SSL在线工具 SSL证书在线工具SSL Online Tools\nReference:\n  那些证书相关的玩意儿(SSL,X.509,PEM,DER,CRT,CER,KEY,CSR,P12等)\n  How To Create a Self-Signed SSL Certificate for Nginx in Ubuntu 16.04\n  OpenSSL Essentials: Working with SSL Certificates, Private Keys and CSRs\n ","wordCount":"1160","inLanguage":"en","datePublished":"2016-06-03T06:27:00Z","dateModified":"2016-06-03T06:27:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://phpgao.github.io/encryption_decryption.html"},"publisher":{"@type":"Organization","name":"老高的技术博客","logo":{"@type":"ImageObject","url":"https://phpgao.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://phpgao.github.io/ accesskey=h title="老高的博客 (Alt + H)">老高的博客</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://phpgao.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://phpgao.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://blog.phpgao.com title="old blog"><span>old blog</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://phpgao.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://phpgao.github.io/posts/>Posts</a></div><h1 class=post-title>证书，密钥，加密，rsa到底是啥？</h1><div class=post-meta>June 3, 2016&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/2016-06-03_encryption_decryption.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>简单的回答：</p><p>证书也叫CA(Certification Authority)证书；密钥就是用来加解密用的文件或者字符串；rsa即非对称加密算法。</p><p><img loading=lazy src=https://blog.phpgao.com/usr/uploads/2016/06/2098671918.png alt=RSA></p><h2 id=密钥>密钥<a hidden class=anchor aria-hidden=true href=#密钥>#</a></h2><p>密钥在非对称加密的领域里，指的是私钥和公钥，他们总是成对出现，其主要作用是加密和解密，具体原理可以参考<a href=https://zh.wikipedia.org/wiki/RSA%E5%8A%A0%E5%AF%86%E6%BC%94%E7%AE%97%E6%B3%95>RSA加密算法</a>。</p><p>需要指出的是，WIKI中提到<strong>1999年，RSA-155 (512 bits)被成功分解</strong>，<strong>2009年12月12日，编号为RSA-768（768 bits, 232 digits）数也被成功分解</strong>，目前老高建议直接使用2048-bit或4086-bit的加密强度。</p><h3 id=openssl>openssl<a hidden class=anchor aria-hidden=true href=#openssl>#</a></h3><ul><li><a href=https://www.openssl.org/docs/manmaster/>openssl EN文档</a></li><li><a href=http://linux.51yip.com/search/openssl>openssl 中文文档</a></li></ul><p>在说私钥公钥之前，大家可能需要先熟悉熟悉openssl命令行工具，<a href=http://www.openssl.org>openssl</a>是一个强大的加密、解密工具，由开源组织维护。利用openssl工具，我们可以实现一些常见的摘要算法，如<a href=https://blog.phpgao.com/md5_sha1_sha2_in_linux.html>Linux下简单计算md5,base64,sha1,sha2</a></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 帮助信息</span>

Standard<span style=color:#f92672>(</span>标准<span style=color:#f92672>)</span> commands
asn1parse      ca             ciphers        crl            crl2pkcs7
dgst           dh             dhparam        dsa            dsaparam
ec             ecparam        enc            engine         errstr
gendh          gendsa         genrsa         nseq           ocsp
passwd         pkcs12         pkcs7          pkcs8          prime
rand           req            rsa            rsautl         s_client
s_server       s_time         sess_id        smime          speed
spkac          verify         version        x509

Message Digest<span style=color:#f92672>(</span>信息摘要<span style=color:#f92672>)</span> commands <span style=color:#f92672>(</span>see the <span style=color:#e6db74>`</span>dgst<span style=color:#e6db74>&#39; command for more details)
</span><span style=color:#e6db74>md2            md4            md5            mdc2           rmd160
</span><span style=color:#e6db74>sha            sha1
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>Cipher(加密) commands (see the `enc&#39;</span> command <span style=color:#66d9ef>for</span> more details<span style=color:#f92672>)</span>
aes-128-cbc    aes-128-ecb    aes-192-cbc    aes-192-ecb    aes-256-cbc
aes-256-ecb    base64         bf             bf-cbc         bf-cfb
bf-ecb         bf-ofb         cast           cast-cbc       cast5-cbc
cast5-cfb      cast5-ecb      cast5-ofb      des            des-cbc
des-cfb        des-ecb        des-ede        des-ede-cbc    des-ede-cfb
des-ede-ofb    des-ede3       des-ede3-cbc   des-ede3-cfb   des-ede3-ofb
des-ofb        des3           desx           rc2            rc2-40-cbc
rc2-64-cbc     rc2-cbc        rc2-cfb        rc2-ecb        rc2-ofb
rc4            rc4-40         seed           seed-cbc       seed-cfb
seed-ecb       seed-ofb

<span style=color:#75715e># 加密的相关命令</span>
options are
-in &lt;file&gt;     input file
-out &lt;file&gt;    output file
-pass &lt;arg&gt;    pass phrase source
-e             encrypt
-d             decrypt
-a/-base64     base64 encode/decode, depending on encryption flag
-k             passphrase is the next argument
-kfile         passphrase is the first line of the file argument
-md            the next argument is the md to use to create a key
                 from a passphrase.  One of md2, md5, sha or sha1
-K/-iv         key/iv in hex is the next argument
-<span style=color:#f92672>[</span>pP<span style=color:#f92672>]</span>          print the iv/key <span style=color:#f92672>(</span><span style=color:#66d9ef>then</span> exit <span style=color:#66d9ef>if</span> -P<span style=color:#f92672>)</span>
-bufsize &lt;n&gt;   buffer size
-engine e      use engine e, possibly a hardware device.
</code></pre></div><h3 id=处理数据>处理数据<a hidden class=anchor aria-hidden=true href=#处理数据>#</a></h3><h4 id=信息摘要>信息摘要<a hidden class=anchor aria-hidden=true href=#信息摘要>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># base64</span>
echo -n <span style=color:#e6db74>&#34;phpgao&#34;</span> | openssl base64
<span style=color:#75715e># 解密 -d == decrypt</span>
echo <span style=color:#e6db74>&#34;cGhwZ2Fv&#34;</span> | openssl base64 -d
<span style=color:#75715e># 对一个文件计算摘要，下同</span>
openssl base64 -in nginx.conf
<span style=color:#75715e># md5</span>
echo -n <span style=color:#e6db74>&#34;phpgao&#34;</span> | openssl md5
<span style=color:#75715e># sha128</span>
echo -n <span style=color:#e6db74>&#34;phpgao&#34;</span> | openssl sha1
</code></pre></div><h4 id=加密解密>加密解密<a hidden class=anchor aria-hidden=true href=#加密解密>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 使用rc4算法加密php字符串，使用密钥phpgao，输出使用base64编码</span>
echo -n <span style=color:#e6db74>&#34;php&#34;</span> | openssl rc4 -k phpgao -base64

<span style=color:#75715e># 使用rc4算法解密字符串，使用密钥phpgao，输入使用base64编码</span>
echo U2FsdGVkX18f3qEoEhVf+hsNOg<span style=color:#f92672>==</span> | openssl rc4 -d -k phpgao -base64
</code></pre></div><h4 id=密钥相关操作>密钥相关操作<a hidden class=anchor aria-hidden=true href=#密钥相关操作>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 生成私钥</span>
<span style=color:#75715e># genrsa 指使用rsa算法生成密钥文件</span>
<span style=color:#75715e># -des3 指的是给私钥加密的算法(可选)</span>
openssl genrsa -des3 -out key_rsa <span style=color:#ae81ff>4096</span>
openssl genrsa -out key_rsa <span style=color:#ae81ff>4096</span>
<span style=color:#75715e># 移除已经存在的密码(先做一下备份)</span>
cp key_rsa old.key
openssl rsa -in old.key -out key_rsa

<span style=color:#75715e># 根据刚才创建的私钥创建公钥</span>
openssl rsa -in key_rsa -pubout -out key_rsa.pub

<span style=color:#75715e># 使用公钥加密数据</span>
<span style=color:#75715e># -in 输入文件</span>
echo -n <span style=color:#e6db74>&#34;phpgao&#34;</span> | openssl rsautl -encrypt -pubin -inkey key_rsa.pub -out a.txt

<span style=color:#75715e># 使用私钥解密数据</span>
openssl rsautl -decrypt -inkey key_rsa -in a.txt

<span style=color:#75715e># 查看密钥信息</span>
openssl rsa -in key_rsa -text -noout
openssl rsa -pubin -in key_rsa.pub -text -noout

<span style=color:#75715e># 检查私钥</span>
openssl rsa -check -in key_rsa
<span style=color:#75715e># 检查一个CSR文件(后面有讲)</span>
openssl req -text -noout -verify -in domain.csr
<span style=color:#75715e># 检查证书信息</span>
openssl x509 -text -noout -in domain.crt
</code></pre></div><h4 id=一些补充>一些补充<a hidden class=anchor aria-hidden=true href=#一些补充>#</a></h4><h5 id=关于密钥的格式>关于密钥的格式<a hidden class=anchor aria-hidden=true href=#关于密钥的格式>#</a></h5><p>密钥的格式有很多种，我们在使用的时候需要注意。我们刚才使用openssl生成的密钥格式叫PKCS#1，不同的程序可能需要不同格式的密钥，不同格式的密钥是可以转换的。</p><p>RSA Private Key (<a href=https://en.wikipedia.org/wiki/PKCS_1>PKCS#1</a>):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>-----BEGIN RSA PRIVATE KEY-----
BASE64 ENCODED DATA
-----END RSA PRIVATE KEY-----
</code></pre></div><p>PKCS#1 RSA Public Key:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>-----BEGIN RSA PUBLIC KEY-----
BASE64 ENCODED DATA
-----END RSA PUBLIC KEY-----
</code></pre></div><p>X.509 Public Key:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>-----BEGIN PUBLIC KEY-----
BASE64 ENCODED DATA
-----END PUBLIC KEY-----
</code></pre></div><p>PKCS#8 Private Key:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>-----BEGIN PRIVATE KEY-----
BASE64 ENCODED DATA
-----END PRIVATE KEY-----
</code></pre></div><p>PKCS#8 Encrypted Private Key:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>-----BEGIN ENCRYPTED PRIVATE KEY-----
BASE64 ENCODED DATA
-----END ENCRYPTED PRIVATE KEY-----
</code></pre></div><p>SSH public key:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6Fo/HHPELU4TLdQwZtidB4hph8xTQberQ8467l2wkXFKV1dlBncCLUA6SUD9JypHIb3I6VNv3rnoEWtRsQYFX5TwGqnxxxH7ZjMt2O1NE9OTEf7H50QmkhHBEKruuEt+OrRXSL6gwHwuAYvGl2nWyKhdaKPg2AMHV6NV3hKEiyEhCe9XCg72KTdHTOVpDS2RjnsU4spyioi9OVj5Eu3vjBeQUifULJzbgMqB0kYS+mJSiol+ZK2YOp1HdiR7vxqfi7r+d8LDhGox8mO00nlYc4h7LBOe75G5KktSbTt5Pyiim+DF6efvmtj2zJ/nN3H2ZHG1dLVQl82QJ8Kz3Rosh laogao@local
</code></pre></div><p>参考<a href=http://blog.oddbit.com/2011/05/08/converting-openssh-public-keys/>Converting OpenSSH public keys</a>，我们可以使用命令 <code>ssh-keygen -f id_rsa.pub -e -m pem</code> 将ssh-rsa格式转为PKCS#1 PEM格式。</p><p>更多格式（我们经常用到的没几个）：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#75715e>#define PEM_STRING_X509_OLD &#34;X509 CERTIFICATE&#34;
</span><span style=color:#75715e>#define PEM_STRING_X509     &#34;CERTIFICATE&#34;
</span><span style=color:#75715e>#define PEM_STRING_X509_PAIR    &#34;CERTIFICATE PAIR&#34;
</span><span style=color:#75715e>#define PEM_STRING_X509_TRUSTED &#34;TRUSTED CERTIFICATE&#34;
</span><span style=color:#75715e>#define PEM_STRING_X509_REQ_OLD &#34;NEW CERTIFICATE REQUEST&#34;
</span><span style=color:#75715e>#define PEM_STRING_X509_REQ &#34;CERTIFICATE REQUEST&#34;
</span><span style=color:#75715e>#define PEM_STRING_X509_CRL &#34;X509 CRL&#34;
</span><span style=color:#75715e>#define PEM_STRING_EVP_PKEY &#34;ANY PRIVATE KEY&#34;
</span><span style=color:#75715e>#define PEM_STRING_PUBLIC   &#34;PUBLIC KEY&#34;
</span><span style=color:#75715e>#define PEM_STRING_RSA      &#34;RSA PRIVATE KEY&#34;
</span><span style=color:#75715e>#define PEM_STRING_RSA_PUBLIC   &#34;RSA PUBLIC KEY&#34;
</span><span style=color:#75715e>#define PEM_STRING_DSA      &#34;DSA PRIVATE KEY&#34;
</span><span style=color:#75715e>#define PEM_STRING_DSA_PUBLIC   &#34;DSA PUBLIC KEY&#34;
</span><span style=color:#75715e>#define PEM_STRING_PKCS7    &#34;PKCS7&#34;
</span><span style=color:#75715e>#define PEM_STRING_PKCS7_SIGNED &#34;PKCS #7 SIGNED DATA&#34;
</span><span style=color:#75715e>#define PEM_STRING_PKCS8    &#34;ENCRYPTED PRIVATE KEY&#34;
</span><span style=color:#75715e>#define PEM_STRING_PKCS8INF &#34;PRIVATE KEY&#34;
</span><span style=color:#75715e>#define PEM_STRING_DHPARAMS &#34;DH PARAMETERS&#34;
</span><span style=color:#75715e>#define PEM_STRING_DHXPARAMS    &#34;X9.42 DH PARAMETERS&#34;
</span><span style=color:#75715e>#define PEM_STRING_SSL_SESSION  &#34;SSL SESSION PARAMETERS&#34;
</span><span style=color:#75715e>#define PEM_STRING_DSAPARAMS    &#34;DSA PARAMETERS&#34;
</span><span style=color:#75715e>#define PEM_STRING_ECDSA_PUBLIC &#34;ECDSA PUBLIC KEY&#34;
</span><span style=color:#75715e>#define PEM_STRING_ECPARAMETERS &#34;EC PARAMETERS&#34;
</span><span style=color:#75715e>#define PEM_STRING_ECPRIVATEKEY &#34;EC PRIVATE KEY&#34;
</span><span style=color:#75715e>#define PEM_STRING_PARAMETERS   &#34;PARAMETERS&#34;
</span><span style=color:#75715e>#define PEM_STRING_CMS      &#34;CMS&#34;
</span></code></pre></div><p>列表来自<a href=http://stackoverflow.com/questions/20065304/what-is-the-differences-between-begin-rsa-private-key-and-begin-private-key>what is the differences between “BEGIN RSA PRIVATE KEY” and “BEGIN PRIVATE KEY”</a></p><h2 id=ca证书>CA证书<a hidden class=anchor aria-hidden=true href=#ca证书>#</a></h2><p>证书与密钥不同，CA证书指的是权威机构给我们颁发的证书，我们的电脑或者电子设备中内置了根证书，我们的电脑信任根证书。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>
   +-----------------+                    +--------------------+
   |                 |                    |                    |
   |                 |                    |                    |
   |                 |                    |                    |
   |   browser/PC    |  ① GET / HTTP/1.0 |                    |
   |                 |--------------------&gt;  sites over https  |
   |                 ① WAIT! Where is CA ?|                   |
   |                 +--------------------&gt;                    |
   |                 |  ④ Anyway,give me |                    |
   +-----+----^------+   the code!        +--------------------+
         |    |
         |    |
         |    |③ He is good!
② Is&#39;s it|    |
a bad site?   |
         |    |    +----------------------+
         |    |    |                      |
         |    +----+                      |
         |         |                      |
         |         |         CA           |
         +---------&gt;                      |
                   |                      |
                   |                      |
                   +----------------------+

</code></pre></div><h3 id=证书原理>证书原理<a hidden class=anchor aria-hidden=true href=#证书原理>#</a></h3><p>CA证书能够帮助我们鉴别某一个网站的合法性，简单的概括一下原理：</p><ol><li>生成我的公钥</li><li>CA机构用自己的私钥加密我的公钥以及相关信息</li><li>客户信任CA，并拥有CA的公钥，客户就可以使用公钥解密加密后的证书，并从证书中得到我的公钥</li><li>如果能用CA的公钥解密出数据，说明我的证书是经过CA认证过的，客户就可以放心访问了，如果系统发现证书不是权威CA机构颁发的，会警告用户</li><li>客户使用我的公钥解密数据，然后进行信息交换</li></ol><p>有一些需要注意的地方：</p><ul><li>证书有有效期这一说</li><li>证书中的相关信息，需要包括改证书到根证书的信任链，如下图，bing.com的证书中，就能够顺藤摸瓜，找到根CA机构，所以在生成自己的证书后，一定要加入这个信任链才能让系统正确的识别到与证书相关的最终根CA。</li></ul><p><img loading=lazy src=https://blog.phpgao.com/usr/uploads/2016/06/1972470616.png alt=bing的证书信息></p><p><strong>↑</strong> bing的证书信息</p><p><img loading=lazy src=https://blog.phpgao.com/usr/uploads/2016/06/2384445590.png alt=blog.phpgao.com的证书></p><p><strong>↑</strong> blog.phpgao.com的证书信息</p><h3 id=证书格式>证书格式<a hidden class=anchor aria-hidden=true href=#证书格式>#</a></h3><p>SSL使用X.509证书标准，编码格式有两种。</p><h4 id=证书的编码格式>证书的编码格式<a hidden class=anchor aria-hidden=true href=#证书的编码格式>#</a></h4><p>PEM(Privacy Enhanced Mail)，通常用于数字证书认证机构（Certificate Authorities，CA），扩展名为.pem, .crt, .cer, and .key。内容为Base64编码的ASCII码文件，有类似"&mdash;&ndash;BEGIN CERTIFICATE&mdash;&ndash;" 和 &ldquo;&mdash;&ndash;END CERTIFICATE&mdash;&ndash;&ldquo;的头尾标记。服务器认证证书，中级认证证书和私钥都可以储存为PEM格式（认证证书其实就是公钥）。Apache和nginx等类似的服务器使用PEM格式证书。</p><p>DER(Distinguished Encoding Rules)，与PEM不同之处在于其使用二进制而不是Base64编码的ASCII。扩展名为.der，但也经常使用.cer用作扩展名，所有类型的认证证书和私钥都可以存储为DER格式。Java使其典型使用平台。</p><h4 id=证书编码的转换>证书编码的转换<a hidden class=anchor aria-hidden=true href=#证书编码的转换>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># PEM转为DER
openssl x509 -in cert.crt -outform der -out cert.der

# DER转为PEM
openssl x509 -in cert.crt -inform der -outform pem -out cert.pem
</code></pre></div><h3 id=csr>CSR<a hidden class=anchor aria-hidden=true href=#csr>#</a></h3><blockquote><p>In public key infrastructure (PKI) systems, a certificate signing request (also CSR or certification request) is a message sent from an applicant to a certificate authority in order to apply for a digital identity certificate. The most common format for CSRs is the PKCS #10 specification and another is the Signed Public Key and Challenge Spkac format generated by some Web browsers. - <a href=https://en.wikipedia.org/wiki/Certificate_signing_request>Wiki of Certificate signing request</a></p></blockquote><p>CSR(Certificate Signing Request)，它是向CA机构申请数字身份证书时使用的请求文件，他最常见的格式是PKCS #10。在生成请求文件前，我们需要准备一对对称密钥。私钥信息自己保存，请求中会附上公钥信息以及国家，城市，域名，Email等信息，csr中还会附上签名信息。当我们准备好CSR文件后就可以提交给CA机构，等待他们给我们签名，签好名后我们会收到crt文件，即证书。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># 帮助
openssl req -h
# 生成CSR请求文件和私钥
openssl req -nodes -days 365 -newkey rsa:2048 -keyout key_rsa -out domain.csr
# 从已存在的私钥生生成CSR请求文件
openssl req -new -days 365 -key key_rsa -out domain.csr

# 信息可以直接写好
openssl req -new -days 3650 -key key_rsa -out domain.csr -subj \
&#34;/C=CN/ST=Shanghai/L=Shanghai/O=Qihoo 360/OU=IT Dept/CN=blog.phpgao.com/emailAddress=admin@phpgao.com&#34;

# 检查CSR文件信息
openssl req -text -noout -verify -in domain.csr
</code></pre></div><h3 id=crt>CRT<a hidden class=anchor aria-hidden=true href=#crt>#</a></h3><p>其实我们最终就需要一个私钥文件和证书文件，这一步骤我们会得到CRT文件。</p><h4 id=自签名>自签名<a hidden class=anchor aria-hidden=true href=#自签名>#</a></h4><p>当我们生成好CSR文件后，就可以开始签名了，是的，自己给自己签名！</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>openssl ca -h
# 先生成一个CA根证书
openssl req -x509 -nodes -days 36500 -newkey rsa:2048 -keyout key_ca_rsa -out ca.crt
# 使用CA的私钥签名
openssl ca -policy policy_anything -days 365 -cert ca.crt -keyfile key_rsa -in domain.csr -out domain.crt

# 可能会出错，因为缺少一些必要文件
mkdir -p demoCA/newCerts
touch demoCA/index.txt 
echo -n &#34;01&#34; &gt; demoCA/serial

</code></pre></div><h4 id=直接生成证书>直接生成证书<a hidden class=anchor aria-hidden=true href=#直接生成证书>#</a></h4><p>我们当然也可以直接生成CRT文件。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># 生成证书和私钥
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout key_rsa -out key.crt
# 从已存在的私钥生成生成证书
openssl req -x509 -new -days 365 -key domain.key -out domain.crt


# 检查证书信息
openssl x509 -text -noout -in domain.crt
</code></pre></div><h2 id=补充信息>补充信息<a hidden class=anchor aria-hidden=true href=#补充信息>#</a></h2><h3 id=csr所需要的信息>CSR所需要的信息<a hidden class=anchor aria-hidden=true href=#csr所需要的信息>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>CN = Country Name (2 letter code)
ST = State or Province Name (full name)
L  = Locality Name (eg, city)
O  = Organization Name (eg, company)
OU = Organizational Unit Name
CN = Common Name (eg, your name or your server&#39;s hostname)

# 例子

Country Name (2 letter code) [AU]:CN
State or Province Name (full name) [Some-State]:Shanghai
Locality Name (eg, city) []:Shanghai
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Qihoo 360
Organizational Unit Name (eg, section) []:IT Dept
Common Name (e.g. server FQDN or YOUR name) []:blog.phpgao.com
Email Address []:admin@phpgao.com

# 我们可以在需要输入以上信息的时候直接用下面的选项，就不用在一个一个输入了
-subj \
&#34;/C=CN/ST=Shanghai/L=Shanghai/O=Qihoo 360/OU=IT Dept/CN=blog.phpgao.com/emailAddress=admin@phpgao.com&#34;
</code></pre></div><h3 id=diffie-hellman>Diffie-Hellman<a hidden class=anchor aria-hidden=true href=#diffie-hellman>#</a></h3><p>Diffie-Hellman加密算法的最终目的是为了完成通信双方对称秘钥的交互，但是它牛逼在即使处在不安全的环境（有人侦听）也不会造成秘钥泄露，生成的时间会比较长，请耐心等待。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048
</code></pre></div><p>使用方法：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>ssl_dhparam /etc/ssl/certs/dhparam.pem;
</code></pre></div><h3 id=ssl的nginx配置>SSL的nginx配置<a hidden class=anchor aria-hidden=true href=#ssl的nginx配置>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># from https://cipherli.st/
# and https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html

ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_prefer_server_ciphers on;
ssl_ciphers &#34;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH&#34;;
ssl_ecdh_curve secp384r1;
ssl_session_cache shared:SSL:10m;
ssl_session_tickets off;
ssl_stapling on;
ssl_stapling_verify on;
resolver 8.8.8.8 8.8.4.4 valid=300s;
resolver_timeout 5s;
add_header Strict-Transport-Security &#34;max-age=63072000; includeSubdomains; preload&#34;;
add_header X-Frame-Options DENY;
add_header X-Content-Type-Options nosniff;

ssl_dhparam /etc/ssl/certs/dhparam.pem;
</code></pre></div><h3 id=ssl在线工具>SSL在线工具<a hidden class=anchor aria-hidden=true href=#ssl在线工具>#</a></h3><p><a href=https://csr.chinassl.net/>SSL证书在线工具SSL Online Tools</a></p><p>Reference:</p><ul><li><p><a href=http://www.cnblogs.com/guogangj/p/4118605.html>那些证书相关的玩意儿(SSL,X.509,PEM,DER,CRT,CER,KEY,CSR,P12等)</a></p></li><li><p><a href=https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-16-04>How To Create a Self-Signed SSL Certificate for Nginx in Ubuntu 16.04</a></p></li><li><p><a href=https://www.digitalocean.com/community/tutorials/openssl-essentials-working-with-ssl-certificates-private-keys-and-csrs>OpenSSL Essentials: Working with SSL Certificates, Private Keys and CSRs</a></p></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://phpgao.github.io/tags/rsa/>rsa</a></li><li><a href=https://phpgao.github.io/tags/ca/>ca</a></li></ul><nav class=paginav><a class=prev href=https://phpgao.github.io/self_signed_ssl_site.html><span class=title>« Prev Page</span><br><span>在Linux下建立自签名的https网站</span></a>
<a class=next href=https://phpgao.github.io/md5_sha1_sha2_in_linux.html><span class=title>Next Page »</span><br><span>Linux下简单计算md5,base64,sha1,sha2</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://phpgao.github.io/>老高的技术博客</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>