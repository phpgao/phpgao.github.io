<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>使用dropbox同步备份网站和数据库 | 老高的技术博客</title><meta name=keywords content="database,Linux,dropbox,sync,backup"><meta name=description content="自从用了Shadowsocks，整个人都精神多了！
今天开整Dropbox，话说这货也被Q了。
废话不多说
以下内容需要翻{防屏蔽}墙使用，如果没有，可以参考老高的这篇文章搭建一个稳定又极速的翻{防屏蔽}墙环境
下载
在官网找到linux专用脚本，执行一下对应系统的脚本
32位系统
cd ~ && wget -O - &#34;https://www.dropbox.com/download?plat=lnx.x86&#34; | tar xzf -
64位系统
cd ~ && wget -O - &#34;https://www.dropbox.com/download?plat=lnx.x86_64&#34; | tar xzf -
"><meta name=author content="Me"><link rel=canonical href=https://phpgao.github.io/dropbox_sync_cli.html><link crossorigin=anonymous href=/assets/css/stylesheet.min.1a6ee89730e13a801d0f34e0cb5b98e96cf8c65b80500638bd599fc224ed8442.css integrity="sha256-Gm7olzDhOoAdDzTgy1uY6Wz4xluAUAY4vVmfwiTthEI=" rel="preload stylesheet" as=style><link rel=preload href="https://cdn.v2ex.com/gravatar/2b66f45a3e2f41db6522381006bfaea1?s=192" as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://phpgao.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://phpgao.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://phpgao.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://phpgao.github.io/apple-touch-icon.png><link rel=mask-icon href=https://phpgao.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-39288145-2','auto'),ga('send','pageview'))</script><meta property="og:title" content="使用dropbox同步备份网站和数据库"><meta property="og:description" content="自从用了Shadowsocks，整个人都精神多了！
今天开整Dropbox，话说这货也被Q了。
废话不多说
以下内容需要翻{防屏蔽}墙使用，如果没有，可以参考老高的这篇文章搭建一个稳定又极速的翻{防屏蔽}墙环境
下载
在官网找到linux专用脚本，执行一下对应系统的脚本
32位系统
cd ~ && wget -O - &#34;https://www.dropbox.com/download?plat=lnx.x86&#34; | tar xzf -
64位系统
cd ~ && wget -O - &#34;https://www.dropbox.com/download?plat=lnx.x86_64&#34; | tar xzf -
"><meta property="og:type" content="article"><meta property="og:url" content="https://phpgao.github.io/dropbox_sync_cli.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-07-29T08:24:00+00:00"><meta property="article:modified_time" content="2014-07-29T08:24:00+00:00"><meta property="og:site_name" content="老高的技术博客"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用dropbox同步备份网站和数据库"><meta name=twitter:description content="自从用了Shadowsocks，整个人都精神多了！
今天开整Dropbox，话说这货也被Q了。
废话不多说
以下内容需要翻{防屏蔽}墙使用，如果没有，可以参考老高的这篇文章搭建一个稳定又极速的翻{防屏蔽}墙环境
下载
在官网找到linux专用脚本，执行一下对应系统的脚本
32位系统
cd ~ && wget -O - &#34;https://www.dropbox.com/download?plat=lnx.x86&#34; | tar xzf -
64位系统
cd ~ && wget -O - &#34;https://www.dropbox.com/download?plat=lnx.x86_64&#34; | tar xzf -
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://phpgao.github.io/posts/"},{"@type":"ListItem","position":2,"name":"使用dropbox同步备份网站和数据库","item":"https://phpgao.github.io/dropbox_sync_cli.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"使用dropbox同步备份网站和数据库","name":"使用dropbox同步备份网站和数据库","description":"自从用了Shadowsocks，整个人都精神多了！\n今天开整Dropbox，话说这货也被Q了。\n废话不多说\n以下内容需要翻{防屏蔽}墙使用，如果没有，可以参考老高的这篇文章搭建一个稳定又极速的翻{防屏蔽}墙环境\n下载 在官网找到linux专用脚本，执行一下对应系统的脚本\n32位系统 cd ~ \u0026amp;\u0026amp; wget -O - \u0026#34;https://www.dropbox.com/download?plat=lnx.x86\u0026#34; | tar xzf - 64位系统 cd ~ \u0026amp;\u0026amp; wget -O - \u0026#34;https://www.dropbox.com/download?plat=lnx.x86_64\u0026#34; | tar xzf - ","keywords":["database","Linux","dropbox","sync","backup"],"articleBody":"自从用了Shadowsocks，整个人都精神多了！\n今天开整Dropbox，话说这货也被Q了。\n废话不多说\n以下内容需要翻{防屏蔽}墙使用，如果没有，可以参考老高的这篇文章搭建一个稳定又极速的翻{防屏蔽}墙环境\n下载 在官网找到linux专用脚本，执行一下对应系统的脚本\n32位系统 cd ~ \u0026\u0026 wget -O - \"https://www.dropbox.com/download?plat=lnx.x86\" | tar xzf - 64位系统 cd ~ \u0026\u0026 wget -O - \"https://www.dropbox.com/download?plat=lnx.x86_64\" | tar xzf - 安装 运行~/.dropbox-dist/dropboxd，系统会提示你去登陆一下，这一步是为了关联账户！很重要！\n登录完成，稍等片刻系统就会提示可以使用了，同时你会发现home下多了一个Dropbox的文件夹，没错，就是他！以后需要同步的文件都放在那里就OK！\n使用脚本 不知道大家记住刚才官网里有一句话，Download this CLI script to control Dropbox，我们去把它下载下来，连接在这儿\n官方wiki里有针对脚本的使用说明，链接在此\n在此仅作简要说明\n需求  At least version 2.4 of the C library wget Python 2.x ≥ 2.5 (we do not offer support for Python 3.0) a web browser  下载脚本至~/bin mkdir -p ~/bin wget -O ~/bin/dropbox.py \"https://www.dropbox.com/download?dl=packages/dropbox.py\" chmod +x ~/bin/dropbox.py 获取帮助 ~/bin/dropbox.py help which will show you all the commands you can use status 获取 dropboxd 的运行状态 help 提供帮助 puburl 获取一个文件的共享链接 stop 停止 dropboxd running 返回 dropboxd 是否在运行 start 运行 dropboxd filestatus 获取一个或多个文件的同步状态 ls 显示文件(夹)的同步状态 autostart 用户登录时自动启动 dropboxd exclude 同步时排除文件夹 lansync 启用禁用局域网同步 命令实例 ~/bin/dropbox.py status Indexing 317 files... ~/bin/dropbox.py help ~/bin/dropbox.py puburl ~/Dropbox/Public/file.zip http://dl.dropbox.com/u/XXXXXXX/file.zip ~/bin/dropbox.py stop Dropbox daemon stopped. ~/bin/dropbox.py help running dropbox running Returns 1 if running 0 if not running. ~/bin/dropbox.py help exclude dropbox exclude [list] dropbox exclude add [DIRECTORY] [DIRECTORY] ... dropbox exclude remove [DIRECTORY] [DIRECTORY] ... \"list\" prints a list of directories currently excluded from syncing. \"add\" adds one or more directories to the exclusion list, then resynchronizes Dropbox. \"remove\" removes one or more directories from the exclusion list, then resynchronizes Dropbox. With no arguments, executes \"list\". Any specified path must be within Dropbox. 解绑 如果你的主机换了，原来的Dropbox确定不用，下面的操作可以让你轻松解绑你的账户和bropbox的关联\n 删除linux主机上的一切有关文件(注意备份) rm -rf ~/.dropbox Dropbox .dropbox-dist 在官网登录你的账户 在右上角点击你的名字 在下拉菜单中找到设置(setting) 选择安全(security)选项卡 在网页下面找到设备(devices) 点击对应设备后面的X解绑  开机启动 vi /etc/rc.local su - xxx -c \"~/bin/dropbox.py start\" # xxx为你的用户名 定时开关 老高的机器上运行dropbox会占用50M左右的内存，平时不需要运行，只需要在新文件生成后运行即可！\n下面是运行和停止dropbox的shell脚本。\n#!/bin/bash  echo $1 if [ $1 == 'start' ]; then su - xxx -c \"~/bin/dropbox.py start\" elif [ $1 == 'stop' ]; then su - xxx -c \"~/bin/dropbox.py stop\" fi # xxx为你的用户名 我们在每天的00:05和12:05运行，然后在15min后停止运行。\n# 编辑计划任务 crontab -e # ADD # dropbox 5 00,12 * * * sh ~/dropbox.sh start 20 00,12 * * * sh ~/dropbox.sh stop 备份网站和数据库 下面是备份网站用的简单脚本，需要替换xxx为用户名，还有密码和数据库信息需要修改！\n#/bin/bash DATE=`date +%Y%m%d` YESTERDAY=`date +%Y%m%d -d -1days` MONTH=`date +%Y%m` RQ=`date +%Y%m%d%H%M` user=\"xxx\" nglogs='/var/log/nginx/logs' # Directory DIR=\"/home/xxx/Dropbox/backup/$DATE\" # Mysql files FILE_MY=\"$DIR/${RQ}-mysql.tar.gz\" # Html files FILE_HTML=\"$DIR/${RQ}-site.tar.gz\" # Access files FILE_ACCESS=\"$DIR/${RQ}-access.tar.gz\" # Hour HOUR=`date +%H` # Make directory mkdir -p $DIR pid_path=\"/var/run/nginx/nginx.pid\" # 切割日志 if [ \"$HOUR\" == \"00\" ];then mkdir -p $nglogs/phpgao/$MONTH cp $nglogs/phpgao.access.log $nglogs/phpgao/$MONTH/$YESTERDAY.access.log mv $nglogs/phpgao.access.log /tmp/$YESTERDAY.access.log cd /tmp tar zcf $FILE_ACCESS $YESTERDAY.access.log rm -f /tmp/$YESTERDAY.access.log kill -USR1 `cat ${pid_path}` fi mysqldump -u xxx -p not-a-really-password --add-drop-table --databases database1 database2  /tmp/mysql.sql # tar mysql cd /tmp tar zcf $FILE_MY mysql.sql rm -f /tmp/mysql.sql # tar html cd /home/ tar zcf $FILE_HTML ftp/* chown -R $user:$user $DIR dropbox太占内存，我们只需要他运行一小会儿就行，写一个计划任务！\n# dropbox 5 00,12 * * * sh ~/dropbox.sh start 20 00,12 * * * sh ~/dropbox.sh stop 解绑 解绑参考官方问答\n","wordCount":"431","inLanguage":"en","datePublished":"2014-07-29T08:24:00Z","dateModified":"2014-07-29T08:24:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://phpgao.github.io/dropbox_sync_cli.html"},"publisher":{"@type":"Organization","name":"老高的技术博客","logo":{"@type":"ImageObject","url":"https://phpgao.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://phpgao.github.io/ accesskey=h title="老高的博客 (Alt + H)">老高的博客</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://phpgao.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://phpgao.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://blog.phpgao.com title="old blog"><span>old blog</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://phpgao.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://phpgao.github.io/posts/>Posts</a></div><h1 class=post-title>使用dropbox同步备份网站和数据库</h1><div class=post-meta>July 29, 2014&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/2014-07-29_dropbox_sync_cli.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>自从用了Shadowsocks，整个人都精神多了！</p><p>今天开整Dropbox，话说这货也被Q了。</p><p>废话不多说</p><p>以下内容需要翻{防屏蔽}墙使用，如果没有，可以参考<a href=https://blog.phpgao.com/shadowsocks_on_linux.html>老高的这篇文章</a>搭建一个稳定又极速的翻{防屏蔽}墙环境</p><h2 id=下载>下载<a hidden class=anchor aria-hidden=true href=#下载>#</a></h2><p>在<a href="https://www.dropbox.com/install?os=lnx">官网</a>找到linux专用脚本，执行一下对应系统的脚本</p><h3 id=32位系统>32位系统<a hidden class=anchor aria-hidden=true href=#32位系统>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>cd ~ &amp;&amp; wget -O - &#34;https://www.dropbox.com/download?plat=lnx.x86&#34; | tar xzf -
</code></pre></div><h3 id=64位系统>64位系统<a hidden class=anchor aria-hidden=true href=#64位系统>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>cd ~ &amp;&amp; wget -O - &#34;https://www.dropbox.com/download?plat=lnx.x86_64&#34; | tar xzf -
</code></pre></div><h2 id=安装>安装<a hidden class=anchor aria-hidden=true href=#安装>#</a></h2><p>运行<code>~/.dropbox-dist/dropboxd</code>，系统会提示你去登陆一下，这一步是为了<strong>关联账户</strong>！很重要！</p><p>登录完成，稍等片刻系统就会提示可以使用了，同时你会发现<code>home</code>下多了一个Dropbox的文件夹，没错，就是他！以后需要同步的文件都放在那里就OK！</p><h2 id=使用脚本>使用脚本<a hidden class=anchor aria-hidden=true href=#使用脚本>#</a></h2><p>不知道大家记住刚才官网里有一句话，<code>Download this CLI script to control Dropbox</code>，我们去把它下载下来，连接在<a href="https://www.dropbox.com/download?dl=packages/dropbox.py">这儿</a></p><p>官方wiki里有针对脚本的使用说明，<a href=http://www.dropboxwiki.com/tips-and-tricks/using-the-official-dropbox-command-line-interface-cli>链接在此</a></p><p>在此仅作简要说明</p><h3 id=需求>需求<a hidden class=anchor aria-hidden=true href=#需求>#</a></h3><ul><li>At least version 2.4 of the C library</li><li>wget</li><li>Python 2.x ≥ 2.5 (we do not offer support for Python 3.0)</li><li>a web browser</li></ul><h3 id=下载脚本至bin>下载脚本至~/bin<a hidden class=anchor aria-hidden=true href=#下载脚本至bin>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir -p ~/bin
wget -O ~/bin/dropbox.py <span style=color:#e6db74>&#34;https://www.dropbox.com/download?dl=packages/dropbox.py&#34;</span>
chmod +x ~/bin/dropbox.py
</code></pre></div><h3 id=获取帮助>获取帮助<a hidden class=anchor aria-hidden=true href=#获取帮助>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~/bin/dropbox.py help

which will show you all the commands you can use

status       获取 dropboxd 的运行状态
help         提供帮助
puburl       获取一个文件的共享链接
stop         停止 dropboxd
running      返回 dropboxd 是否在运行
start        运行 dropboxd
filestatus   获取一个或多个文件的同步状态
ls           显示文件<span style=color:#f92672>(</span>夹<span style=color:#f92672>)</span>的同步状态
autostart    用户登录时自动启动 dropboxd
exclude      同步时排除文件夹
lansync      启用禁用局域网同步
</code></pre></div><h3 id=命令实例>命令实例<a hidden class=anchor aria-hidden=true href=#命令实例>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~/bin/dropbox.py status
Indexing <span style=color:#ae81ff>317</span> files...

~/bin/dropbox.py help

~/bin/dropbox.py puburl ~/Dropbox/Public/file.zip
http://dl.dropbox.com/u/XXXXXXX/file.zip

~/bin/dropbox.py stop
Dropbox daemon stopped.

~/bin/dropbox.py help running
dropbox running
Returns <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>if</span> running <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>if</span> not running.

~/bin/dropbox.py help exclude
dropbox exclude <span style=color:#f92672>[</span>list<span style=color:#f92672>]</span>
dropbox exclude add <span style=color:#f92672>[</span>DIRECTORY<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>DIRECTORY<span style=color:#f92672>]</span> ...
dropbox exclude remove <span style=color:#f92672>[</span>DIRECTORY<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>DIRECTORY<span style=color:#f92672>]</span> ...
<span style=color:#e6db74>&#34;list&#34;</span> prints a list of directories currently excluded from syncing.  
<span style=color:#e6db74>&#34;add&#34;</span> adds one or more directories to the exclusion list, <span style=color:#66d9ef>then</span> resynchronizes Dropbox. 
<span style=color:#e6db74>&#34;remove&#34;</span> removes one or more directories from the exclusion list, <span style=color:#66d9ef>then</span> resynchronizes Dropbox.
With no arguments, executes <span style=color:#e6db74>&#34;list&#34;</span>. 
Any specified path must be within Dropbox.
</code></pre></div><h3 id=解绑>解绑<a hidden class=anchor aria-hidden=true href=#解绑>#</a></h3><p>如果你的主机换了，原来的Dropbox确定不用，下面的操作可以让你轻松解绑你的账户和bropbox的关联</p><ul><li>删除linux主机上的一切有关文件(<strong>注意备份</strong>)
<code>rm -rf ~/.dropbox Dropbox .dropbox-dist</code></li><li>在<a href=https://www.dropbox.com/login>官网</a>登录你的账户</li><li>在右上角点击你的名字</li><li>在下拉菜单中找到设置(setting)</li><li>选择安全(security)选项卡</li><li>在网页下面找到设备(devices)</li><li>点击对应设备后面的X解绑</li></ul><h2 id=开机启动>开机启动<a hidden class=anchor aria-hidden=true href=#开机启动>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vi /etc/rc.local
su - xxx -c <span style=color:#e6db74>&#34;~/bin/dropbox.py start&#34;</span>
<span style=color:#75715e># xxx为你的用户名</span>
</code></pre></div><h2 id=定时开关>定时开关<a hidden class=anchor aria-hidden=true href=#定时开关>#</a></h2><p>老高的机器上运行dropbox会占用50M左右的内存，平时不需要运行，只需要在新文件生成后运行即可！</p><p>下面是运行和停止dropbox的shell脚本。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
echo $1

<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $1 <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;start&#39;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
    su - xxx -c <span style=color:#e6db74>&#34;~/bin/dropbox.py start&#34;</span>
<span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> $1 <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;stop&#39;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
    su - xxx -c <span style=color:#e6db74>&#34;~/bin/dropbox.py stop&#34;</span>
<span style=color:#66d9ef>fi</span>
<span style=color:#75715e># xxx为你的用户名</span>
</code></pre></div><p>我们在每天的00:05和12:05运行，然后在15min后停止运行。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 编辑计划任务</span>
crontab -e

<span style=color:#75715e># ADD</span>
<span style=color:#75715e># dropbox</span>
<span style=color:#ae81ff>5</span> 00,12 * * * sh ~/dropbox.sh start
<span style=color:#ae81ff>20</span> 00,12 * * *  sh ~/dropbox.sh stop
</code></pre></div><h2 id=备份网站和数据库>备份网站和数据库<a hidden class=anchor aria-hidden=true href=#备份网站和数据库>#</a></h2><p>下面是备份网站用的简单脚本，需要替换xxx为用户名，还有密码和数据库信息需要修改！</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#/bin/bash</span>

DATE<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>date +%Y%m%d<span style=color:#e6db74>`</span>
YESTERDAY<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>date +%Y%m%d -d -1days<span style=color:#e6db74>`</span>
MONTH<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>date +%Y%m<span style=color:#e6db74>`</span>
RQ<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>date +%Y%m%d%H%M<span style=color:#e6db74>`</span>
user<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;xxx&#34;</span>
nglogs<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;/var/log/nginx/logs&#39;</span>
<span style=color:#75715e># Directory</span>
DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/xxx/Dropbox/backup/</span>$DATE<span style=color:#e6db74>&#34;</span>
<span style=color:#75715e># Mysql files</span>
FILE_MY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$DIR<span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>RQ<span style=color:#e6db74>}</span><span style=color:#e6db74>-mysql.tar.gz&#34;</span>
<span style=color:#75715e># Html files</span>
FILE_HTML<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$DIR<span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>RQ<span style=color:#e6db74>}</span><span style=color:#e6db74>-site.tar.gz&#34;</span>
<span style=color:#75715e># Access files</span>
FILE_ACCESS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$DIR<span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>RQ<span style=color:#e6db74>}</span><span style=color:#e6db74>-access.tar.gz&#34;</span>
<span style=color:#75715e># Hour</span>
HOUR<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>date +%H<span style=color:#e6db74>`</span>

<span style=color:#75715e># Make directory</span>
mkdir -p $DIR


pid_path<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/run/nginx/nginx.pid&#34;</span>

<span style=color:#75715e># 切割日志</span>
<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$HOUR<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;00&#34;</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
    mkdir -p $nglogs/phpgao/$MONTH
    cp $nglogs/phpgao.access.log $nglogs/phpgao/$MONTH/$YESTERDAY.access.log
    mv $nglogs/phpgao.access.log /tmp/$YESTERDAY.access.log
    cd /tmp
    tar zcf $FILE_ACCESS $YESTERDAY.access.log
    rm -f /tmp/$YESTERDAY.access.log
    kill -USR1 <span style=color:#e6db74>`</span>cat <span style=color:#e6db74>${</span>pid_path<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>
<span style=color:#66d9ef>fi</span>


mysqldump -u xxx -p not-a-really-password --add-drop-table --databases database1 database2 &gt; /tmp/mysql.sql

<span style=color:#75715e># tar mysql</span>
cd /tmp
tar zcf $FILE_MY mysql.sql
rm -f /tmp/mysql.sql
<span style=color:#75715e># tar html</span>
cd /home/
tar zcf $FILE_HTML ftp/*
chown -R $user:$user $DIR
</code></pre></div><p>dropbox太占内存，我们只需要他运行一小会儿就行，写一个计划任务！</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># dropbox</span>
<span style=color:#ae81ff>5</span> 00,12 * * * sh ~/dropbox.sh start
<span style=color:#ae81ff>20</span> 00,12 * * *  sh ~/dropbox.sh stop
</code></pre></div><h2 id=解绑-1>解绑<a hidden class=anchor aria-hidden=true href=#解绑-1>#</a></h2><p>解绑参考<a href=https://www.dropbox.com/help/25>官方问答</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://phpgao.github.io/tags/database/>database</a></li><li><a href=https://phpgao.github.io/tags/linux/>Linux</a></li><li><a href=https://phpgao.github.io/tags/dropbox/>dropbox</a></li><li><a href=https://phpgao.github.io/tags/sync/>sync</a></li><li><a href=https://phpgao.github.io/tags/backup/>backup</a></li></ul><nav class=paginav><a class=prev href=https://phpgao.github.io/pip-easy_install-setuptool.html><span class=title>« Prev Page</span><br><span>升级python2.7和安装pip,easy_install和setuptool</span></a>
<a class=next href=https://phpgao.github.io/python_arrow_key_messup.html><span class=title>Next Page »</span><br><span>python交互模式下方向键乱码的正确解决方法</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://phpgao.github.io/>老高的技术博客</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>